(function(b){var a=function(f,e){var d=e.length;for(var c=0;c<d;c++){if(e[c]==f){return true}}return false};b.fn.kcReorder=function(j,e){var h=new RegExp(j+"\\]\\[(\\d+)"),g=new RegExp(j+"\\-(\\d+)"),d=b(this);if(e===true){var f=d.children(),c=0}else{var f=d,c=d.index()}f.each(function(){var i=b(this);i.find(":input").each(function(){this.name=this.name.replace(h,function(l,k){return j+"]["+c});if(this.id!==""){this.id=this.id.replace(g,function(l,k){return j+"-"+c})}});i.find("label").each(function(){var k=b(this),l=b(this).attr("for");if(l){k.attr("for",l.replace(g,function(n,m){return j+"-"+c}))}});c++});return this};b.fn.kcFormDep=function(){return this.each(function(){var c=b(this),d=c.val(),e=(c.data("scope")!==undefined)?c.closest(c.data("scope")).find(c.data("child")):b(c.data("child"));if(!e.length){return}e.each(function(){var g=b(this),f=g.data("dep");if((typeof f==="string"&&f===d)||(typeof f==="object"&&a(d,f))){g.show()}else{g.hide()}})})};b(document).ready(function(f){var c=f("#widgets-right"),e=c.find(".kcw-control-block"),d=c.find("h5");f(".hasdep",e).live("change",function(){f(this).kcFormDep()}).change();f(".widgets-sortables").ajaxSuccess(function(){f(".hasdep",this).live("change",function(){f(this).kcFormDep()}).change()});d.live("click",function(){f(this).next(".kcw-control-block").slideToggle("slow")});f(".kcw-control-block .del").live("click",function(k){k.preventDefault();var i=f(this),h=i.parent(),j=h.parent(),g=h.next(".row");h.slideUp(function(){if(!h.siblings(".row").length){h.find('input[type="text"]').val("");h.find('input[type="checkbox"]').prop("checked",false);h.find(".hasdep").trigger("change")}else{h.remove();if(g.length){j.kcReorder(i.attr("rel"),true)}}})});f(".kcw-control-block .add").live("click",function(i){i.preventDefault();var h=f(this),g=h.parent().prev(".row");if(g.is(":hidden")){g.slideDown()}else{$nu=g.clone(true).hide();g.after($nu);$nu.slideDown().kcReorder(h.attr("rel"),false)}})})})(jQuery);